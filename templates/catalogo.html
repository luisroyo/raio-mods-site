{% extends "base.html" %}

{% block title %}{{ parent.name }} - RAIO MODS{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/catalogo.css') }}">
{% endblock %}

{% block content %}
    <main class="container mx-auto px-4 md:px-6 pb-8 md:pb-16 catalog-main">
        <div class="mb-6 md:mb-8" data-aos="fade-up">
            <a href="{{ url_for('public.index') }}" class="inline-flex items-center gap-2 text-gray-400 hover:text-neon-cyan transition-colors text-sm md:text-base mb-4">
                ‚Üê Voltar para a loja
            </a>
            <h1 class="text-2xl md:text-4xl font-bold neon-cyan">{{ parent.name }}</h1>
            <p class="text-gray-400 mt-2">Escolha uma op√ß√£o abaixo</p>
        </div>

        {% if products %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-12 md:mb-20">
            {% for product in products %}
            <div class="catalog-product-card group" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
                <div class="absolute top-3 right-3 flex items-center gap-1.5 bg-black/60 px-2 py-1 rounded border border-green-500/50 z-10">
                    <span class="relative flex h-2 w-2">
                        <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <span class="text-[10px] font-bold text-green-400 tracking-wider">ATUALIZADO</span>
                </div>
                {% if product.promo_price or product.promo_label %}
                <div class="absolute top-3 left-3 z-10">
                    <span class="px-2 py-1 rounded text-xs font-bold bg-amber-500 text-black border border-amber-400">{{ product.promo_label or 'PROMO' }}</span>
                </div>
                {% endif %}
                {% if product.image %}
                <div class="catalog-img-container">
                    <img src="{{ product.image }}" alt="{{ product.name }}" class="w-full h-full object-cover">
                </div>
                {% endif %}
                
                <h3 class="text-xl md:text-2xl font-bold neon-cyan mb-2">{{ product.name }}</h3>
                
                <p class="text-gray-300 mb-3 md:mb-4 min-h-[40px] md:min-h-[50px] text-sm md:text-base flex-grow">
                    {{ product.description }}
                </p>
                
                <div class="mb-4 md:mb-6 mt-auto">
                    {% if product.promo_price %}
                    <p class="text-lg md:text-xl text-gray-500 line-through mb-0.5">{{ product.price }}</p>
                    <p class="text-3xl md:text-4xl font-bold neon-green mb-2">{{ product.promo_price }}</p>
                    {% else %}
                    <p class="text-3xl md:text-4xl font-bold neon-green mb-2">{{ product.price }}</p>
                    {% endif %}
                    {% if product.tagline %}
                    <p class="text-xs md:text-sm text-gray-400">{{ product.tagline }}</p>
                    {% endif %}
                </div>
                
                {% set display_price = product.promo_price or product.price %}
                {% if (stock_map is defined and stock_map.get(product.id, 0) > 0) or (stock_map is not defined) %}
                <button onclick="openCheckout({{ product.id }}, '{{ product.name }}', '{{ display_price }}')" 
                        class="catalog-btn-buy hover:shadow-[0_0_25px_rgba(0,242,255,0.5)] transition-all w-full flex items-center justify-center gap-2 cursor-pointer">
                    <span>üõí Comprar Agora</span>
                </button>
                {% else %}
                <div class="rounded-lg border border-amber-500/60 bg-amber-500/10 p-4 text-center">
                    <p class="text-amber-400 font-semibold mb-2">Sem estoque no momento.</p>
                    <p class="text-gray-400 text-sm mb-3">Entre em contato com o administrador pelo WhatsApp para mais informa√ß√µes.</p>
                    {% if whatsapp_contact %}
                    <a href="https://wa.me/{{ whatsapp_contact }}" target="_blank" rel="noopener" class="inline-flex items-center justify-center gap-2 w-full py-3 bg-green-600 hover:bg-green-500 text-white font-bold rounded-lg transition-colors">
                        üì≤ Contatar no WhatsApp
                    </a>
                    {% else %}
                    <p class="text-gray-500 text-xs">WhatsApp n√£o configurado. Contate o suporte.</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-catalog" data-aos="fade-up">
            <p class="text-xl neon-cyan mb-4">Nenhuma op√ß√£o neste cat√°logo ainda.</p>
            <a href="{{ url_for('public.index') }}" class="inline-block px-6 py-3 bg-neon-cyan text-black font-bold rounded-lg hover:bg-opacity-80 transition-colors">
                ‚Üê Voltar para a loja
            </a>
        </div>
        {% endif %}

        {% if total_pages > 1 %}
        <nav class="flex justify-center gap-2 mt-8 mb-12" data-aos="fade-up">
            {% if page > 1 %}
            <a href="{{ url_for('public.catalogo', parent_id=parent.id, page=page-1) }}" class="px-4 py-2 border border-neon-cyan rounded-lg text-neon-cyan hover:bg-neon-cyan hover:text-black transition">‚Üê Anterior</a>
            {% endif %}
            <span class="px-4 py-2 text-gray-400">P√°gina {{ page }} de {{ total_pages }}</span>
            {% if page < total_pages %}
            <a href="{{ url_for('public.catalogo', parent_id=parent.id, page=page+1) }}" class="px-4 py-2 border border-neon-cyan rounded-lg text-neon-cyan hover:bg-neon-cyan hover:text-black transition">Pr√≥xima ‚Üí</a>
            {% endif %}
        </nav>
        {% endif %}
    </main>
{% endblock %}

{% block extra_js %}
    <script src="{{ url_for('static', filename='js/catalogo.js') }}"></script>
{% endblock %}